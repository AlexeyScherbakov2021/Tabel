<UserControl x:Name="userControl" x:Class="Tabel.Views.ModUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Tabel.Views"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:fa="http://schemas.fontawesome.com/icons/"
            xmlns:vm="clr-namespace:Tabel.ViewModels"
             xmlns:conv="clr-namespace:Tabel.Infrastructure.Converters"
            xmlns:ext="clr-namespace:Tabel.Infrastructure.Extend"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <UserControl.DataContext>
        <vm:ModUCViewModel/>
    </UserControl.DataContext>
    <UserControl.Resources>

        <conv:AddWorksConverter x:Key="AddWorksConverter"/>
        <vm:ModUCViewModel x:Key="context"/>

        <Style TargetType="{x:Type ComboBox}" BasedOn="{StaticResource StyleCheckComboBox }">
        </Style>


    </UserControl.Resources>
    <DockPanel>
        <ToolBarPanel DockPanel.Dock="Top" Orientation="Horizontal" Height="30" Margin="10,8,0,4">
            <Button  Command="{Binding CreateCommand}" Margin="3" Style="{DynamicResource ButtonStyleShadow}" ToolTip="Создать">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Solid_FileMedical" Width="24" Height="16" Foreground="#FF005AA0"/>
                    <TextBlock Text="Создать"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding SaveCommand}" Margin="3" Style="{DynamicResource ButtonStyleShadow}" ToolTip="Сохранить">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Solid_Save" Width="24" Height="16" Foreground="#FF005AA0"/>
                    <TextBlock Text="Сохранить"/>
                </StackPanel>
            </Button>
        </ToolBarPanel>


        <TabControl x:Name="tab">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding TabChangedCommand}" CommandParameter="{Binding SelectedIndex, ElementName=tab}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <TabItem Header="По табелю">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{DynamicResource DataGridStyle}" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}"/>
                            <DataGridTextColumn Header="Дложность" Binding="{Binding person.p_profession}"/>
                            <DataGridTextColumn Header="Разряд" Binding="{Binding person.category.id}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Тариф" Binding="{Binding person.category.cat_tarif, StringFormat=0.#}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Часы" Binding="{Binding TabelHours, StringFormat=0.#}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Отсут." Binding="{Binding TabelAbsent}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Дни" Binding="{Binding TabelDays}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Оклад" Binding="{Binding Oklad, StringFormat=N2}" Width="70" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Итого" Binding="{Binding Itogo, StringFormat=N2}" Width="80" FontWeight="Bold" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
            
            <TabItem Header="Премия по выработке">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <!--<CheckBox Grid.Column=""/>-->
                        <!--<TextBlock Text="Часы из ФП" Grid.Column="0"/>-->
                        <!--<TextBox Text="{Binding SumFP.mo_sumFP, Mode=TwoWay}" Grid.Column="1" VerticalAlignment="Center"/>-->
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="% премии" Binding="{Binding md_premFP, Mode=TwoWay, StringFormat=N2}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Часы из ФП" Binding="{Binding md_sumFromFP, StringFormat=N2}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Расчетные часы" Binding="{Binding premiaFP.SummaHoursFP, StringFormat=N2}" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Премиальный тариф" Binding="{Binding md_cat_prem_tarif, StringFormat=N2}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Премия" Binding="{Binding premiaFP.SummaPremFP, StringFormat=N2}" Width="90" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Группа" Binding="{Binding md_group}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="% группы" Binding="{Binding premiaFP.ProcGroup, StringFormat=0.##%}" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
            
            <TabItem Header="Пермия 1">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{Binding ActualWidth, ElementName=col1}"/>
                            <ColumnDefinition Width="{Binding ActualWidth, ElementName=col2}"/>
                            <ColumnDefinition Width="{Binding ActualWidth, ElementName=col3}"/>
                            <ColumnDefinition Width="{Binding ActualWidth, ElementName=col4}"/>
                            <ColumnDefinition Width="{Binding ActualWidth, ElementName=col5}"/>
                            <!--<ColumnDefinition Width="*"/>-->
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center" Width="40"
                                Command="{Binding CheckCommand}" CommandParameter="{Binding ElementName=dgBonus}"
                                HorizontalContentAlignment="Left"
                                Style="{StaticResource ButtonStyleShadow}">
                            <CheckBox IsChecked="{Binding IsCheckBonus}"/>
                        </Button>
                        <Button  Grid.Column="3" HorizontalAlignment="Center" VerticalAlignment="Center" Width="60" 
                                 HorizontalContentAlignment="Left"
                                 Style="{StaticResource ButtonStyleShadow}">
                            <TextBox Text="000" Width="35"/>
                        </Button>
                        <Button  Grid.Column="4" HorizontalAlignment="Center" VerticalAlignment="Center" Width="80" 
                                 HorizontalContentAlignment="Left"
                                 Style="{StaticResource ButtonStyleShadow}">
                            <TextBox Text="000" Width="54"/>
                        </Button>
                    </Grid>
                    <DataGrid x:Name="dgBonus" ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn x:Name="col1" Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn x:Name="col2" Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridCheckBoxColumn x:Name="col3" Header="Выполнено" Binding="{Binding md_bonus_exec, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <DataGridTextColumn x:Name="col4" Header="%" MinWidth="80" Binding="{Binding md_bonus_proc, Mode=TwoWay, StringFormat=0.#}"  Width="50" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn x:Name="col5" MinWidth="100" Header="Макс. бонус" Binding="{Binding md_bonus_max, Mode=TwoWay, StringFormat=N0}"  CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Расчет" Binding="{Binding premiaBonus.Bonus, StringFormat=N2}" Width="80" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>


            <TabItem Header="Квалификационная премия">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Работа с ОР" Binding="{Binding md_kvalif_prem, StringFormat=N2}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Премия" Binding="{Binding premiaKvalif.Kvalif_Summa, StringFormat=N2}" Width="90" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>


            <TabItem Header="Премия 2 (по отделу/участку)">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Макс. премия" Binding="{Binding md_prem_otdel, Mode=TwoWay, StringFormat=N0}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="% выполнения" Binding="{Binding md_prem_otdel_proc, Mode=TwoWay, StringFormat=0.#}"  CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Премия" Binding="{Binding premiaOtdel.PremOtdel, StringFormat=N2}" Width="90" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <TabItem Header="Работа в выходной день">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" />
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" />
                            <DataGridTextColumn Header="Число дней" Binding="{Binding TabelWorkOffDay, Mode=TwoWay}" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Доплата" Binding="{Binding md_tarif_offDay, StringFormat=N0}" Width="80" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Сумма" Binding="{Binding premOffDays.DayOffSumma, StringFormat=N2}" Width="90"  CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>

            </TabItem>

            <TabItem Header="Доп. работы">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" IsReadOnly="False"
                              SelectedItem="{Binding SelectedPerson, Mode=TwoWay}"
                              >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}"  IsReadOnly="True"/>

                            <!--<DataGridComboBoxColumn Header="Доп. работа" 
                                ItemsSource="{Binding DataContext.ListWorks, ElementName=userControl}" ElementStyle="{Binding Mode=OneWay, Source={StaticResource StyleCheckComboBox}}"
                             />-->

                            <DataGridTemplateColumn Header="Работы"  Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding ListAddWorks, Converter={StaticResource AddWorksConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition MinWidth="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}" Width="0"/>
                                            </Grid.ColumnDefinitions>
                                            <Popup IsOpen="{Binding IsChecked, ElementName=toggle}" Grid.ColumnSpan="2" >
                                                <ListBox ItemsSource="{Binding DataContext.ListWorks, ElementName=userControl}"  >
                                                    <ListBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <CheckBox Content="{Binding aw_Name}" IsChecked="{Binding IsChecked, Mode=TwoWay}"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </ListBox.ItemTemplate>
                                                </ListBox>
                                            </Popup>
                                            <ToggleButton x:Name="toggle" DockPanel.Dock="Right" Grid.ColumnSpan="2" 
                                                          IsChecked="{Binding DataContext.IsCheckedButton, ElementName=userControl}"
                                                          Style="{StaticResource ComboBoxToggleButton}">
                                            </ToggleButton>
                                            <TextBlock Text="{Binding ListAddWorks, Converter={StaticResource AddWorksConverter}}" IsHitTestVisible="False" Foreground="Black"/>
                                        </Grid>
                                        <!--<ComboBox ItemsSource="{Binding ListWorks, Source={StaticResource context}}"
                                                  DisplayMemberPath="aw_Name"
                                                  Text="7777"
                                                  />-->
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Тариф" Binding="{Binding AddWorksSumma, StringFormat=N2}" Width="90"  CellStyle="{StaticResource CellRight}" IsReadOnly="True"/>

                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <TabItem Header="Доставка">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Стоимость доставки" Binding="{Binding TransportSumma, StringFormat=N2}" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>

            </TabItem>

            <TabItem Header="Вечерние">
                <DockPanel  Background="Gainsboro">
                    <Grid DockPanel.Dock="Top" Margin="8,0" Height="30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                    <DataGrid ItemsSource="{Binding ListModPerson}" Style="{StaticResource DataGridStyle}" >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding person.FIO}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Должность" Binding="{Binding person.p_profession}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Доплата 20%" Binding="{Binding NightOklad, StringFormat=0.#}" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                            <DataGridTextColumn Header="Часы" Binding="{Binding NightHours, Mode=TwoWay, StringFormat=0.#}"  CellStyle="{StaticResource CellRight}"  IsReadOnly="True"/>
                            <DataGridTextColumn Header="Сумма" Binding="{Binding NightSumma, StringFormat=N2}" Width="90" IsReadOnly="True" CellStyle="{StaticResource CellRight}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>

            </TabItem>

            <TabItem Header="За добросовестный труд">
                
            </TabItem>
        </TabControl>

    </DockPanel>
</UserControl>
